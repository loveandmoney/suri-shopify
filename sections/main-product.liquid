{% schema %}

{
  "name": "t:sections.main-product.name",
  "tag": "section",
  "blocks": [
    {
      "type": "@app"
    }, {
      "type": "title",
      "name": "t:sections.main-product.blocks.title.name",
      "limit": 1
    }, {
      "type": "price",
      "name": "t:sections.main-product.blocks.price.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "message",
          "label": "Message"
        }
      ]
    }, {
      "type": "variant_picker",
      "name": "t:sections.main-product.blocks.variant_picker.name",
      "limit": 1
    }, {
      "type": "quantity_selector",
      "name": "t:sections.main-product.blocks.quantity_selector.name",
      "limit": 1
    }, {
      "type": "buy_buttons",
      "name": "t:sections.main-product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "message",
          "label": "Message"
        }
      ]
    }, {
      "type": "replacement_pack",
      "name": "t:sections.main-product.blocks.replacement_pack.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading"
        }, {
          "type": "text",
          "id": "body",
          "label": "Body"
        }
      ]
    }, {
      "type": "description",
      "name": "t:sections.main-product.blocks.description.name",
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "Description"
        }
      ]
    }, {
      "type": "product_attribute",
      "name": "t:sections.main-product.blocks.product_attribute.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "default": "Product Attribute",
          "label": "Tab Name"
        }, {
          "type": "richtext",
          "id": "content",
          "label": "Tab Content"
        }
      ]
    }
  ],
  "settings": []
}

{% endschema %}

<div class="main-product w-full relative block bg-mono-50" data-template="Product">
  <section>
    <div class="grid">
      {% assign image_count = 0 %}

      <ul class="col-span-5 col-start-2 relative flex flex-wrap justify-between pt-16" role="list">
        {%- for media in product.media -%}
          {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
            {% assign image_count = image_count | plus: 1 %}
            {% assign remainder = image_count | modulo: 3 %}

            <li class="main-product__gallery__item main-product__gallery__item--{% if remainder == 0 %}full{% else %}half{% endif %} relative">
              <div class="w-full relative bg-midnight-black-100">
                <figure class="w-full h-full absolute top-0 right-0 bottom-0 left-0 flex items-center justify-center overflow-hidden">
                  <img class="w-full h-full relative block object-cover" srcset="{% if media.preview_image.width >= 288 %}{{ media.preview_image | img_url: '288x' }} 288w,{% endif %} {% if media.preview_image.width >= 576 %}{{ media.preview_image | img_url: '576x' }} 576w,{% endif %} {% if media.preview_image.width >= 750 %}{{ media.preview_image | img_url: '750x' }} 750w,{% endif %} {% if media.preview_image.width >= 1100 %}{{ media.preview_image | img_url: '1100x' }} 1100w,{% endif %} {% if media.preview_image.width >= 1500 %}{{ media.preview_image | img_url: '1500x' }} 1500w,{% endif %} {{ media.preview_image | img_url: 'master' }} {{ media.preview_image.width }}w" src="{{ media | img_url: '1500x' }}" loading="lazy" width="576" height="{{ 576 | divided_by: media.preview_image.aspect_ratio | ceil }}" alt="{{ media.preview_image.alt | escape }}">
                </figure>
              </div>
            </li>
          {%- endunless -%}
        {%- endfor -%}
      </ul>

      <div class="col-span-4 col-start-8 h-screen sticky top-0 right-0 pt-16">
        {%- liquid
          assign product_form_id = 'product-form-' | append: section.id
          assign price = product.price | default: 1999
          assign available = product.available | default: false
          assign buyable = product.selected_or_first_available_variant.available
          assign money_price = price | money

          if settings.currency_code_enabled
            assign money_price = price | money_with_currency
          endif
        -%}

        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'title' -%}
              <h1 class="h2">{{ product.title | escape }}</h1>

            {%- when 'price' -%}
              <article>
                <div class="w-full relative flex">
                  <h3 class="h2">{{ money_price }}</h3>

                  {%- unless product.price_varies == false and product.compare_at_price_varies %}
                    <h3 class="main-product__compare-at ml-2 h2 line-through">
                      {% if settings.currency_code_enabled %}
                        {{ product.compare_at_price | money_with_currency }}
                      {% else %}
                        {{ product.compare_at_price | money }}
                      {% endif %}
                    </h3>
                  {%- endunless -%}
                </div>

                <p class="mt-4 b3 text-ux-green">{{ block.settings.message }}</p>
              </article>

            {%- when 'variant_picker' -%}
              <article class="main-product__variant-picker relative mt-4">
                {%- unless product.has_only_default_variant -%}
                  <div class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ product.url }}" {{ block.shopify_attributes }}>
                    {%- for option in product.options_with_values -%}
                      <fieldset class="relative">
                        <legend class="b3">
                          <span>{{ option.name }}:
                          </span>
                          <span id="variant-value-{{ option.name | downcase | replace: ' ', '-' }}">
                            {% if option.selected_value == value %}
                              {{ option.value }}
                            {% endif %}
                          </span>
                        </legend>

                        <div class="relative flex">
                          {%- for value in option.values -%}
                            <div class="main-product__variant-picker w-8 h-8 relative block mt-2 mr-2 rounded-full overflow-hidden">
                              <input class="variant-picker w-full h-full absolute top-0 right-0 bottom-0 left-0 z-10 cursor-pointer opacity-0 border" type="radio" id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}" name="{{ option.name }}" value="{{ value | escape }}" form="{{ product_form_id }}" {% if option.selected_value == value %} checked {% endif %}/>

                              <div class="main-product__variant-picker__button w-full h-full relative rounded-full overflow-hidden {% if option.selected_value == value %}active{% endif %}">
                                <div class="w-full h-full relative rounded-full overflow-hidden bg-{{ value | downcase | replace: ' ', '-' }}"></div>
                              </div>
                            </div>
                          {%- endfor -%}
                        </div>
                      </fieldset>
                    {%- endfor -%}
                  </div>
                {%- endunless -%}
              </article>

            {%- when 'quantity_selector' -%}
              <article class="relative mt-4">
                <label class="form__label" for="Quantity-{{ section.id }}">
                  {{ 'products.product.quantity.label' | t }}
                </label>

                <div class="relative">
                  <!-- <button name="minus" type="button">
                    <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}</span>
                  </button> -->

                  <input id="Quantity-{{ section.id }}" name="quantity" class="w-12 relative block mt-2 border" form="{{ product_form_id }}" min="1" value="1" type="number"/>

                  <!-- <button name="plus" type="button">
                    <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: product.title | escape }}</span>
                  </button> -->
                </div>
              </article>

            {%- when 'buy_buttons' -%}
              <article class="relative mt-8">
                {%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled/>

                  <button type="submit" name="add" class="button {% if buyable %}bg-ux-green text-mono-white{% else %}button--disabled bg-mono-75 text-mono-black{% endif %} w-full h-12 relative block" {% if sold_out %} disabled {% endif %}>
                    <span class="button-text">
                      {%- if buyable -%}
                        {{ 'products.product.add_to_cart' | t }}
                      {%- else -%}
                        {{ 'products.product.sold_out' | t }}
                      {%- endif -%}
                    </span>
                  </button>
                {%- endform -%}

                <p class="mt-3 b3 text-black text-center">{{ block.settings.message }}</p>
              </article>

            {%- when 'description' -%}
              <div class="main-product__description relative mt-8 whitespace-pre-wrap b3">{{ block.settings.content }}</div>

            {%- when 'replacement_pack' -%}
              <article class="main-product__pack relative mt-8 p-4 bg-mono-white text-ux-green">
                <div class="w-full relative flex justify-between">
                  <figure class="w-14 h-14 relative block rounded-full overflow-hidden bg-midnight-black-75"></figure>

                  <div class="main-product__pack__content relative">
                    <div class="relative mb-4">
                      <h3 class="b1">{{ block.settings.heading }}</h3>
                      <p class="mt-2 b3">{{ block.settings.body }}</p>
                    </div>

                    <div class="w-full relative block">
                      <button class="button relative block px-3 py-2 bg-white text-ux-green border border-ux-green">
                        <span>+</span>
                        <span>Add (£25.00/pack)</span>
                      </button>
                    </div>
                  </div>
                </div>
              </article>

            {%- when 'product_attribute' -%}
              <article class="main-product__expander w-full relative py-3 border-t border-midnight-black-75">
                <button class="w-full relative block" type="button">
                  <div class="w-full relative flex items-center justify-between">
                    <p class="b3">{{ block.settings.heading }}</p>
                    <p class="caption">arrow</p>
                  </div>
                </button>

                <div class="main-product__expander__text relative block b3">{{ block.settings.content }}</div>
              </article>
          {%- endcase -%}
        {%- endfor -%}
      </div>
    </div>
  </section>
</footer>